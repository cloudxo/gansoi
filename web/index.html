<html>
<head>
    <title>Gansoi monitoring</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/style.css">
</head>
<body>

    <div id="app">
        <div class="buttonbar">
         <router-link class="button" id="overview" to="/overview">Overview</router-link>
         <router-link class="button" id="gansoi" to="/gansoi">Gansoi</router-link>
         <router-link class="button" id="checks" to="/checks">Checks</router-link>
        </div>
      <router-view></router-view>
    </div>

 <div id="main"></div>
</body>

<template id="template-overview">
<h2>Overview</h2>
</template>

<template id="template-nodes">
<div>
<h2>Gansoi</h2>
<h3>Nodes</h3>
<table class="table">
 <tr>
  <th>Name</th>
  <th>Started</th>
  <th>State</th>
  <th>Last contact</th>
  <th>Apply</th>
  <th>Commit</th>
  <th>Last</th>
 </tr>
 <tr v-for="node in nodes.data">
 <td>{{ node.name }}</td>
 <td>{{ node.started }}</td>
 <td>{{ node.raft.state }}</td>
 <td>{{ node.raft.last_contact }}</td>
 <td>{{ node.raft.applied_index }}</td>
 <td>{{ node.raft.commit_index }}</td>
 <td>{{ node.raft.last_log_index }}</td>
 </tr>
</table>
</div>
</template>

<template id="template-checks">
<div>
 <h2>Checks</h2>
 <table class="table">
  <tr>
   <th>ID</th>
   <th>Agent</th>
   <th>Interval</th>
   <th colspan="3"></th>
  </tr>
  <tr is="check-line" v-for="check in checks.data" :check="check"></tr>
 </table>
 <router-link class="button" id="dddd" to="/check/edit/new">Add Check</router-link>
</div>
</template>

<template id="template-check-line">
<tr :class="klass">
 <td>{{ check.id }}</td>
 <td>{{ check.agent }}</td>
 <td>{{ check.interval / 1000000000 }}</td>
 <td><button class="button red" v-on:click="deleteCheck(this)">Delete</button></td>
 <td><button class="button" v-on:click="editCheck()">Edit</button></td>
 <td><button class="button" v-on:click="viewCheck()">Details</button></td>
</tr>
</template>

<template id="template-view-check">
<div>
 <h2>{{ id }} Details</h2>
 <table>
  <tbody v-if="check">
   <tr>
    <td><label>Agent</label></td>
    <td>{{ check.agent }}</td>
   </tr>
   <tr>
    <td><label>Check Interval</label></td>
    <td>{{ check.interval / 1000000000 }} seconds</td>
   </tr>

   <tr><th colspan="2">Arguments</th></tr>
   <tr><td colspan="2"><hr></td></tr>
   <tr v-for="(value, key) in check.arguments">
    <td><label>{{ key }}</label></td>
    <td>{{ value }}</td>
   </tr>

   <tr><th colspan="2">Evaluation</th></tr>
   <tr><td colspan="2"><hr></td></tr>
   <tr v-if="evaluation"><td colspan="2">{{ evaluation.History[0] }}</td></tr>

   <tr><th colspan="2">Latest Results</th></tr>
   <tr><td colspan="2"><hr></td></tr>
   <tr v-if="result.error"><td class="red" colspan="2">ERROR: {{ result.error }}</td></tr>
   <tr v-for="(value, key) in result.results">
    <td>{{ key }}</td>
    <td><label>{{ value }}</label></td>
   </tr>

  </tbody>
 </table>
</div>
</template>

<template id="template-edit-check">
<form>
 <fieldset>
  <table>
   <tbody>
    <tr><th colspan="2">{{ title }}</th></tr>
    <tr><td colspan="2"><hr></td></tr>
    <tr>
     <td><label>Unique Check ID</label></td>
     <td><input type="text" v-model="check.id"/></td>
    </tr>
    <tr>
     <td><label>Check interval</label></td>
     <td><input type="number" min="5" max="3600" v-model="check.interval"> (seconds)</td>
    </tr>
    <tr>
     <td><label>Agent</label></td>
     <td>
      <select v-model="check.agent">
       <option v-for="agent in agents">{{ agent.name }}</option>
      </select>
     </td>
    </tr>

    <tr v-for="argument in arguments">
     <td><label>{{ argument.name }}</label></td>
     <td v-if="argument.type == 'string'"><input type="text" v-model="check.arguments[argument.name]" /> {{ argument.description }}</td>
     <td v-else-if="argument.type == 'bool'"><input type="checkbox" v-model="check.arguments[argument.name]" /><label>{{ argument.description }}</label></td>
     <td v-else-if="argument.type == 'int'"><input type="number" v-model="check.arguments[argument.name]" /><label> {{ argument.description }}</label></td>
     <td v-else>{{ argument.type }} not supported in client</td>
    </tr>

    <tr><th colspan="2">Results</th></tr>
    <tr><td colspan="2"><hr></td></tr>
    <tr v-if="results.error"><td class="red" colspan="2">ERROR: {{ results.error }}</td></tr>
    <tr v-for="(value, key) in results.results">
     <td><label>{{ key }}</label></td>
     <td>{{ value }}</td>
    </tr>

    <tr><th colspan="2">Expressions</th></tr>
    <tr><td colspan="2"><hr></td></tr>
    <tr v-for="(expression, index) in check.expressions">
     <td><label>{{ index }}</label></td>
     <td>
      <input type="text" v-model="check.expressions[index]" />
      <input class="button" type="button" v-on:click="removeExpression(index)" value="Remove" />
     </td>
    </tr>
    <tr>
     <td colspan="2"><input class="button" type="button" v-on:click="addExpression()" value="Add Expression" /></td>
    </tr>
   </tbody>
  </table>
  <input class="button" type="button" value="Test" v-on:click="testCheck()" />
  <input class="button green right" name="add" type="button" value="Add check" v-on:click="addCheck()" />
 </fieldset>
</form>
</template>

<script src="https://unpkg.com/vue@2.1.8/dist/vue.js"></script>
<script src="https://unpkg.com/vue-resource@1.0.3/dist/vue-resource.min.js"></script>
<script src="https://unpkg.com/vue-router@2.0.1"></script>
<script src="/g.js"></script>
<script src="/g-collection.js"></script>
<script src="/g-live.js"></script>
<script src="/g-waitgroup.js"></script>
<script src="/client.js"></script>
</html>
